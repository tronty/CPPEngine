/*
~/Asiakirjat/SDKs/ATI SDK/Samples/Media/Textures$ ls -al *ump*.*
-rw-rw-r-- 1 tronty tronty 349680 Mar 14  2006 brick2Bump3Dc.dds
-rw-rw-r-- 1 tronty tronty  77052 Mar 14  2006 brick2Bump.png
-rw-rw-r-- 1 tronty tronty 349680 Mar 14  2006 brickBump3Dc.dds
-rw-rw-r-- 1 tronty tronty  74397 Mar 14  2006 brickBump.png
-rw-rw-r-- 1 tronty tronty 165832 Mar 14  2006 fieldstoneBump.png
-rw-rw-r-- 1 tronty tronty 349680 Mar 14  2006 genericDetailBump3Dc.dds
-rw-rw-r-- 1 tronty tronty 349653 Mar 14  2006 genericDetailBump.dds
-rw-rw-r-- 1 tronty tronty 349680 Mar 14  2006 layingrockBump3Dc.dds
-rw-rw-r-- 1 tronty tronty  87309 Mar 14  2006 layingrockBump.png
-rw-rw-r-- 1 tronty tronty   2583 Mar 14  2006 parqfloor2Bump.png
-rw-rw-r-- 1 tronty tronty  49374 Mar 14  2006 StoneWallBump.png
-rw-rw-r-- 1 tronty tronty  92103 Mar 14  2006 TilesBump.png
-rw-rw-r-- 1 tronty tronty  33516 Mar 14  2006 wallpaperBump.png
-rw-rw-r-- 1 tronty tronty 104100 Mar 14  2006 WoodBump.png
TilesNormal.dds
~/Asiakirjat/SDKs/NVIDIA Corporation/SDK 9.5/MEDIA$ find . -name *ormal*.*
./textures/2d/AntiAliasingWithTransparency/grass03_normal.dds
./textures/2d/AntiAliasingWithTransparency/grass01_normal.dds
./textures/2d/AntiAliasingWithTransparency/ground_normal.dds
./textures/2d/AntiAliasingWithTransparency/grass02_normal.dds
./textures/2d/add_normals__base.png
./textures/2d/Cloth0NormalMap.dds
./textures/2d/add_normals__detail.png
./textures/2d/Cloth1NormalMap.dds
./textures/2d/Cloth2NormalMap.dds
./textures/2d/wavy_normal.dds
./models/Asteroid/aster1-normal.dds
./models/Ufo-01/UFO-01_Bump-01_bp_normal.dds
./models/SambavaRockChunk/Stone_01-bp_normal.dds
./models/SambavaRockChunk/Ground-01_bp_normal.dds
./models/SambavaRockChunk/Stone_01-detail_normal.dds
./models/Rayguns/Raygun_Metal_01_bp_normal.dds
./models/Rayguns/BumpyLines_normal.dds
./models/WalkerHead/Walker_Head_BP_normal.dds
./models/SpaceShip/missile1-normal.dds
./HLSL_textures/default_bump_normal.dds
./textures/2d/bump_map_torus.png
./textures/2d/Default_bump_32.dds
./textures/2d/AntiAliasingWithTransparency/fence_bump.dds
./textures/2d/bump_map.png
./textures/2d/earth_bump.dds
./textures/2d/earth_bump.png
./models/Ufo-01/UFO-01_Bump-01_bp.dds
./models/Ufo-01/UFO-01_Bump-01_bp_normal.dds
./models/Rayguns/BumpyLines.dds
./models/Rayguns/BumpyLines_normal.dds
./models/AdobeHouse/House_Textures/stucko_bump.tga
./docPix/HLSL/pix512/DiffuseBumpHLSL.jpg
./docPix/HLSL/pix512/BumpGlossedShiny.jpg
./docPix/HLSL/pix512/parallaxBumpMap.jpg
./docPix/HLSL/pix512/BumpPlastic.jpg
./docPix/HLSL/pix512/BumpGlossed.jpg
./docPix/HLSL/pix512/BumpReflectHLSL.jpg
./docPix/HLSL/pix256/DiffuseBumpHLSL.jpg
./docPix/HLSL/pix256/BumpGlossedShiny.jpg
./docPix/HLSL/pix256/parallaxBumpMap.jpg
./docPix/HLSL/pix256/BumpPlastic.jpg
./docPix/HLSL/pix256/BumpGlossed.jpg
./docPix/HLSL/pix256/BumpReflectHLSL.jpg
./docPix/HLSL/pix128/DiffuseBumpHLSL.jpg
./docPix/HLSL/pix128/BumpGlossedShiny.jpg
./docPix/HLSL/pix128/parallaxBumpMap.jpg
./docPix/HLSL/pix128/BumpPlastic.jpg
./docPix/HLSL/pix128/BumpGlossed.jpg
./docPix/HLSL/pix128/BumpReflectHLSL.jpg
./docPix/projects/pix512/bumpGloss.jpg
./docPix/projects/pix256/bumpGloss.jpg
./docPix/projects/pix128/bumpGloss.jpg
./HLSL_textures/default_bump_normal.dds
*/
/*
tronty@dcx-rwyyyyyyyyyyyyyyt-3:~/X10/IndieLib_resources$ find . -name *ump*.*
./IndieLib-Animation-Collision/MiniMario_Jump001.png
./DXJune2010/Dwarf/Body_bumpmap.png
./DXJune2010/Dwarf/Pack_bumpmap.png
./DXJune2010/Dwarf/Helmet_bumpmap.png
./DXJune2010/Dwarf/DwarfHead_bumpmap.png
./DXJune2010/Dwarf/Headgear_bumpmap.png
./DXJune2010/Dwarf/Armor_bumpmap.png
./DXJune2010/Dwarf/Weapons_bumpmap.png
./textures/ATI_SDK/bump_normal/brickBump.png
./textures/ATI_SDK/bump_normal/parqfloor2Bump.png
./textures/ATI_SDK/bump_normal/TilesBump.png
./textures/ATI_SDK/bump_normal/fieldstoneBump.png
./textures/ATI_SDK/bump_normal/layingrockBump.png
./textures/ATI_SDK/bump_normal/wallpaperBump.png
./textures/ATI_SDK/bump_normal/brick2Bump3Dc.dds
./textures/ATI_SDK/bump_normal/WoodBump.png
./textures/ATI_SDK/bump_normal/brickBump3Dc.dds
./textures/ATI_SDK/bump_normal/brick2Bump.png
./textures/ATI_SDK/bump_normal/StoneWallBump.png
./textures/ATI_SDK/bump_normal/layingrockBump3Dc.dds
./textures/NVIDIA_Corporation/bump_normal/earth_bump.dds
./textures/NVIDIA_Corporation/bump_normal/earth_bump.png
./textures/NVIDIA_Corporation/2d/AntiAliasingWithTransparency/fence_bump.dds
./trex_dx/dbodybump.png
./15_Ocean_Water/waterbumps.bmp
./textures/ATI_SDK/bump_normal/TilesNormal.dds
./textures/NVIDIA_Corporation/bump_normal/wavy_normal.dds
./textures/NVIDIA_Corporation/2d/wavy_normal.png
./textures/NVIDIA_Corporation/2d/AntiAliasingWithTransparency/grass03_normal.dds
./textures/NVIDIA_Corporation/2d/AntiAliasingWithTransparency/grass01_normal.dds
./textures/NVIDIA_Corporation/2d/AntiAliasingWithTransparency/ground_normal.dds
./textures/NVIDIA_Corporation/2d/AntiAliasingWithTransparency/grass02_normal.dds
./textures/NVIDIA_Corporation/2d/add_normals__detail.png
./Smoke/Gargoyle/baseMossyNormal.png
./Smoke/Gargoyle/gargoyleMossyNormal.png
./spine/spineboy-old/images/normal/left-upper-leg-normal.png
./spine/spineboy-old/images/normal/eyes-normal.png
./spine/spineboy-old/images/normal/right-foot-normal.png
./spine/spineboy-old/images/normal/right-shoulder-normal.png
./spine/spineboy-old/images/normal/neck-normal.png
./spine/spineboy-old/images/normal/left-hand-normal.png
./spine/spineboy-old/images/normal/left-lower-leg-normal.png
./spine/spineboy-old/images/normal/head-normal.png
./spine/spineboy-old/images/normal/right-lower-leg-normal.png
./spine/spineboy-old/images/normal/right-hand-normal.png
./spine/spineboy-old/images/normal/left-arm-normal.png
./spine/spineboy-old/images/normal/left-shoulder-normal.png
./spine/spineboy-old/images/normal/right-arm-normal.png
./spine/spineboy-old/images/normal/right-upper-leg-normal.png
./spine/spineboy-old/images/normal/pelvis-normal.png
./spine/spineboy-old/images/normal/torso-normal.png
./spine/spineboy-old/images/normal/left-foot-normal.png
*/

/*
  Copyright (c) 2018 Tommi Roenty   http://www.tommironty.fi/
  Licensed under The GNU Lesser General Public License, version 2.1:
      http://opensource.org/licenses/LGPL-2.1
*/
#include <Framework3/IRenderer.h>

TextureID brick=-1;
TextureID brickBump=-1;
MeshRenderer2 shape3D[2];
ShaderID shd=-1;
VertexFormatID vf=-1;
unsigned int m_i=0;

int init(const char* aTitle)
{
	shape3D[1].CreateBox(1.0f, 1.0f, 1.0f, eShaderNone);
        shape3D[0].CreateSphere(1.0f, eShaderNone);

	shd=IRenderer::GetRendererInstance()->addShaderFromFile("/NormalMapping/NormalMapping.shd", "main", "main");
	FormatDesc format[] =
	{
		0, TYPE_VERTEX,   FORMAT_FLOAT, 3,
		0, TYPE_NORMAL,   FORMAT_FLOAT, 3,
		0, TYPE_BINORMAL, FORMAT_FLOAT, 3,
		0, TYPE_TANGENT,  FORMAT_FLOAT, 3,
		0, TYPE_TEXCOORD, FORMAT_FLOAT, 3,
		0, TYPE_TEXCOORD, FORMAT_FLOAT, 2 
	};
	vf = IRenderer::GetRendererInstance()->addVertexFormat(format, elementsOf(format), shd);

	SamplerStateID ss=IRenderer::GetRendererInstance()->Getlinear();
	brick=IRenderer::GetRendererInstance()->addImageLibTexture("/textures/ATI_SDK/bump_normal/brick.png", false, ss);
	brickBump=IRenderer::GetRendererInstance()->addImageLibTexture("/textures/ATI_SDK/bump_normal/brickBump.png", false, ss);
	return 0;
}

void render( )
{
	float f=128.0f/256.0f;
	IRenderer::GetRendererInstance()->Clear(true, true, D3DXFROMWINEVECTOR4 (f, f, f, 1.0f));
	IRenderer::GetRendererInstance()->BeginScene();

	float mAngleX=0.0f;
	float mAngleY=0.0f;
	stx_GetAngles(mAngleX, mAngleY);

		D3DXFROMWINEMATRIX matRot;
		D3DXFROMWINEMatrixRotationYawPitchRoll( &matRot,
		                            D3DXFROMWINEToRadian(mAngleX),
		                            D3DXFROMWINEToRadian(mAngleY),
		                            0.0f );

		D3DXFROMWINEVECTOR4 silver=stx_GetRGBA(eSilver);
		D3DXFROMWINEVECTOR4 AmbientColor=silver;
		D3DXFROMWINEVECTOR4 DiffuseColor=0.1f*silver;
		D3DXFROMWINEVECTOR4 LightDir(0.0f, 0.0f, -1.0f, 1.0f);
		D3DXFROMWINEVECTOR4 EyeDir(0.0f, 0.0f, 1.0f, 1.0f);
	
        shape3D[m_i].BeginDraw(&matRot, -1, shd, vf, AmbientColor, DiffuseColor, LightDir, EyeDir);
	IRenderer::GetRendererInstance()->setShaderConstant4x4f("matWorldViewProj", matRot);
	IRenderer::GetRendererInstance()->setShaderConstant4x4f("matWorld", matRot);  
	IRenderer::GetRendererInstance()->setShaderConstant4f("vecLightDir", LightDir);  
	IRenderer::GetRendererInstance()->setShaderConstant4f("vecEye", EyeDir);  
	IRenderer::GetRendererInstance()->setTexture("ColorMapSampler", brick);
	IRenderer::GetRendererInstance()->setTexture("NormalMapSampler", brickBump);
		shape3D[m_i].EndDraw();

		char* txt = "Use mouse buttons to rotate the model.";
		IRenderer::GetRendererInstance()->drawText(txt, 10, 10, 
			15, 18,
			IRenderer::GetRendererInstance()->GetdefaultFont(), 
			IRenderer::GetRendererInstance()->GetlinearClamp(), 
			IRenderer::GetRendererInstance()->GetblendSrcAlpha(), 
			IRenderer::GetRendererInstance()->GetnoDepthTest());

		txt = "CTRL-r resets the scene.";
		IRenderer::GetRendererInstance()->drawText(txt, 10, 30, 
			15, 18,
			IRenderer::GetRendererInstance()->GetdefaultFont(), 
			IRenderer::GetRendererInstance()->GetlinearClamp(), 
			IRenderer::GetRendererInstance()->GetblendSrcAlpha(), 
			IRenderer::GetRendererInstance()->GetnoDepthTest());

	IRenderer::GetRendererInstance()->EndScene();
	IRenderer::GetRendererInstance()->Present( );
}

int ApplicationLogic()
{	
	IRenderer* r=IRenderer::GetRendererInstance("NormalMapping");	
	IInput*    i=STX_Service::GetInputInstance();
	init("");
	while (!i->OnKeyPress (STX_KEY_ESCAPE) && !i->Quit())
	{
		i->Update();
		render();
	}
	return 0;
}

/*
~/Asiakirjat/SDKs/NVIDIA Corporation/SDK 9.5/MEDIA
./Hlsl/include/normalize.fxh
./programs/D3D9_WaterInteraction/Create_NormalMap_SrcAlpha_Scale.psh
./programs/glsl_physics/normal.glsl
./programs/fast_third_order/shading_normal.fp
./Hlsl/BumpReflectHLSL.fx
./Hlsl/BumpGlossed.fx
./Hlsl/BumpGlossedShiny.fx
./Hlsl/parallaxBumpMap.fx
./Hlsl/DiffuseBumpHLSL.fx
./Hlsl/BumpPlastic.fx
./programs/bump_reflect_local_light/bump_reflect_local_light__gloss.vp
./programs/bump_reflect_local_light/bump_reflect_local_light__reflect.vp
./programs/bumpy_shiny_patch/bumpy_shiny_patch__gloss.vp
./programs/bumpy_shiny_patch/bumpy_shiny_patch__reflect.vp
./programs/bumpy_shiny_patch/bumpy_shiny_patch__refract.vp
./programs/offset_bump_mapping/offset_bump_mapping__dotproduct.vp
./programs/offset_bump_mapping/offset_bump_mapping__dsdt.vp
./programs/HLSL_BumpyShinyVariations/BumpyShinyVariations.fx
./programs/glsl_bump_mapping/bump_mapping_fragment.glsl
./programs/glsl_bump_mapping/bump_mapping_vertex.glsl
*/

