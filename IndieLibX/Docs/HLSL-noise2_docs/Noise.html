<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>


<title>Lumina platform independent GLSL IDE Noise</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="author" content="oc2k1">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="Content-language" content="en">
<meta name="robots" content="index, follow">
<meta name="keywords" content="GLSL, lumina, OpenGL, shader, development, IDE, scene,
renderer, rendering, realtime, vertex, fragment, pixel, vertexshader, fragmentshader,
pixelshader, gears, shadows, script, GPU, GPGPU, shading, toon, toonshading, deferred,
depth, peeling, spaceball, spacemouse, GPL, free, hardware, accelerated, ECMA, normal,
tangent, bitangent, binormal, bumpmapping, bump, mapping, color, Lumina">

<link href="Noise_tiedostot/prettify.css" type="text/css" rel="stylesheet">



<link id="CSS" rel="stylesheet" href="Noise_tiedostot/styles_1.css">
</head><body onload="prettyPrint()" vlink="darkgreen" alink="red" link="green" text="black">
 <!-- onFocus="javascript:winopen()">  onBlur="javascript:dwnld()"//-->




<table align="CENTER" border="0" cellpadding="0" cellspacing="0">
        <tbody><tr>
                <td colspan="7"><img src="Noise_tiedostot/index_01.gif" alt="" width="1000" height="60"></td>
        </tr>
        <tr style="background-image: url(../images/leiste.gif); background-attachment: scroll; background-repeat: repeat-x;">
           
                <td colspan="3"><img src="Noise_tiedostot/index_02.gif" alt="" width="340" height="41"></td>
                <td><a href="http://sourceforge.net/project/showfiles.php?group_id=186618" onmouseover="document.Bild1.src=bild1.src; window.status='Download';  return true;" onmouseout="document.Bild1.src=bild2.src; window.status='';  return true;"><img src="Noise_tiedostot/index_03.gif" alt="" name="Bild1" width="135" border="0" height="41"></a></td>
                <td><a href="http://sourceforge.net/forum/?group_id=186618" onmouseover="document.Bild2.src=bild3.src; window.status='Forum';  return true;" onmouseout="document.Bild2.src=bild4.src; window.status='';  return true;"><img src="Noise_tiedostot/index_04.gif" alt="" name="Bild2" width="100" border="0" height="41"></a></td>
                <td><a href="http://sourceforge.net/tracker/?group_id=186618" onmouseover="document.Bild3.src=bild5.src; window.status='Bugtracker';  return true;" onmouseout="document.Bild3.src=bild6.src; window.status='';  return true;"><img src="Noise_tiedostot/index_05.gif" alt="" name="Bild3" width="145" border="0" height="41"></a></td>
                <td style="background-image: url(../images/index_06.gif); background-attachment: fixed; background-repeat: repeat-x;">
                      <a href="http://sourceforge.net/"><img src="Noise_tiedostot/sflogo.png" alt="SourceForge.net Logo" width="125" border="0" height="37"></a></td>
    </tr>
        <tr>

       <!--       <TD ROWSPAN=3 style="background-image:url(../images/index_07.gif); background-attachment:fixed; background-repeat:repeat-x;" ALIGN=CENTER VALIGN=TOP>
                 treeview part start //-->   

<td rowspan="3" align="left" valign="TOP">

<table align="CENTER" border="0" cellpadding="10" cellspacing="0"><tbody><tr><td style="background-color: rgb(0, 71, 142);">
<a href="http://lumina.sourceforge.net/Home.html" class="links">Home</a><br>
<a href="http://lumina.sourceforge.net/Documentation.html" class="links">Documentation</a><br>
<a href="http://lumina.sourceforge.net/Tutorials.html" class="links">Tutorials</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Beginning.html" class="links">Beginning</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Gears.html" class="links">Gears</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Noise.html" class="links">Noise</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Bumpmapping.html" class="links">Bumpmapping</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Point_sprites.html" class="links">Point&nbsp;sprites</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Hello_World.html" class="links">Hello&nbsp;World</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Armature.html" class="links">Armature</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Geometryshader.html" class="links">Geometryshader</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Toolscripting.html" class="links">Toolscripting</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Keyframe_animation.html" class="links">Keyframe&nbsp;animation</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Instancing.html" class="links">Instancing</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Bezier_Surface.html" class="links">Bezier&nbsp;Surface</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Deferred_shading.html" class="links">Deferred&nbsp;shading</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Depth_peeling.html" class="links">Depth&nbsp;peeling</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://lumina.sourceforge.net/Tutorials/Particle_System.html" class="links">Particle&nbsp;System</a><br>
<a href="http://lumina.sourceforge.net/Links.html" class="links">Links</a><br>
</td></tr><tr><td style="background-image: url(../images/index_07.gif); background-repeat: repeat-x;" align="CENTER" height="128" valign="MIDDLE">


<a href="http://sourceforge.net/donate/index.php?group_id=186618" target="_blank"><img src="Noise_tiedostot/project-support.jpg" alt="Support This Project" width="88" border="0" height="32"></a>


</td></tr><tr><td align="CENTER">
<a href="http://opengl.org/" target="_blank"><img src="Noise_tiedostot/ogl_sm.jpg" alt="OpenGL"></a>


</td></tr></tbody></table>


	</td>
                <td width="11" height="10"></td>
                <td colspan="5" height="10"></td>
        </tr>
        <tr>
                <td width="11" height="479"></td>
                <td colspan="5" rowspan="2" align="JUSTIFY" valign="TOP">
<font size="5">Welcome to the third Lumina tutorial</font>
<br>This tutorial is not only Lumina specific and is about generating procedural noise with 
<br>GLSL. This algorithms are similar or different from other well known like "Perlin Noise"
<br>
<br><font size="4">1. Random</font>
<br>What is noise? The best expample is the snow on a TV. Each pixel is set with a random 
<br>value. But each photo of that screen looks different from a other. In reality there is a 
<br>simple answer for that problem: Record that noise to a video tape and take photos from 
<br>the freeze image and each will look like the other...
<br>
<br>When we want to use random / noise to describe materials it is important that the 
<br>randomnumbers are reproducible. This numbers aren't true randomnumbers because there is 
<br>no random. 
<br>
<br>How to create good and reproducible random numbers?
<br>That is a big problem. Always known are only the inputs. It's a position in a 
<br>N-dimensional space. A good working formula for GPUs is:
<br>
<br>random = fract(sin(in.x * 12.9898 + in.y * 78.233.......)  * 43758.5453);
<br>
<br>this will be compiled to a few instructions: The first step is to combine all input 
<br>dimensions to one value. That is only a simple dot product. The sin() cos() or tan() 
<br>(all three are good) is the second instruction. The multiplication with a big value the 
<br>third and fraction the last.
<br>
<br>The noise algorithms samples the pseudo randomnumbers in regular intervals, that will 
<br>result in an undersampling, which produce together with the fraction of sin() random 
<br>numbers 
<br>that are good enough for graphics. (but not for cryptographic)
<br>
<br>This is a simple random fragmentshader:
<br><pre class="prettyprint"><span class="kwd">float</span><span class="pln"> rand</span><span class="pun">(</span><span class="pln">vec2 co</span><span class="pun">){</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">return</span><span class="pln"> fract</span><span class="pun">(</span><span class="pln">sin</span><span class="pun">(</span><span class="pln">dot</span><span class="pun">(</span><span class="pln">co</span><span class="pun">.</span><span class="pln">xy </span><span class="pun">,</span><span class="pln">vec2</span><span class="pun">(</span><span class="lit">12</span><span class="pun">.</span><span class="lit">9898</span><span class="pun">,</span><span class="lit">78</span><span class="pun">.</span><span class="lit">233</span><span class="pun">)))</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">43758</span><span class="pun">.</span><span class="lit">5453</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="kwd">void</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">){</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;gl_FragColor </span><span class="pun">=</span><span class="pln"> rand</span><span class="pun">(</span><span class="pln">gl_TexCoord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">xy</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span></pre>
<br>It creates a TV like snow. The interval is from 0.0 to 1.0 (not like the noise(gentype) 
<br>function from GLSL that has a range from -1.0 to 1.0 but returns on many cards 0.0)
<br>
<br><font size="4">2. Noise</font>
<br>
<br>The random pixels aren't a material. To create on we have to undersampling the random 
<br>numbers:
<br><pre class="prettyprint"><span class="kwd">float</span><span class="pln"> rand</span><span class="pun">(</span><span class="pln">vec2 co</span><span class="pun">){</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">return</span><span class="pln"> fract</span><span class="pun">(</span><span class="pln">sin</span><span class="pun">(</span><span class="pln">dot</span><span class="pun">(</span><span class="pln">co</span><span class="pun">.</span><span class="pln">xy </span><span class="pun">,</span><span class="pln">vec2</span><span class="pun">(</span><span class="lit">12</span><span class="pun">.</span><span class="lit">9898</span><span class="pun">,</span><span class="lit">78</span><span class="pun">.</span><span class="lit">233</span><span class="pun">)))</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">43758</span><span class="pun">.</span><span class="lit">5453</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="kwd">float</span><span class="pln"> noise</span><span class="pun">(</span><span class="pln">vec2 co</span><span class="pun">){</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">return</span><span class="pln"> rand</span><span class="pun">(</span><span class="pln">floor</span><span class="pun">(</span><span class="pln">co </span><span class="pun">*</span><span class="pln"> </span><span class="lit">128</span><span class="pun">.</span><span class="lit">0</span><span class="pun">));</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="kwd">void</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">){</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;gl_FragColor </span><span class="pun">=</span><span class="pln"> noise</span><span class="pun">(</span><span class="pln">gl_TexCoord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">xy</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span></pre>
<br>That looks like a nearest filtered noise texture. The next step is adding a simple 
<br>bilinear filter:
<br><pre class="prettyprint"><span class="pln">vec4 rand</span><span class="pun">(</span><span class="pln">vec2 A</span><span class="pun">,</span><span class="pln">vec2 B</span><span class="pun">,</span><span class="pln">vec2 C</span><span class="pun">,</span><span class="pln">vec2 D</span><span class="pun">){</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;vec2 s </span><span class="pun">=</span><span class="pln"> vec2 </span><span class="pun">(</span><span class="lit">12</span><span class="pun">.</span><span class="lit">9898</span><span class="pun">,</span><span class="lit">78</span><span class="pun">.</span><span class="lit">233</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;vec4 tmp </span><span class="pun">=</span><span class="pln"> vec4</span><span class="pun">(</span><span class="pln"> dot</span><span class="pun">(</span><span class="pln">A</span><span class="pun">,</span><span class="pln">s</span><span class="pun">),</span><span class="pln">dot</span><span class="pun">(</span><span class="pln">B</span><span class="pun">,</span><span class="pln">s</span><span class="pun">),</span><span class="pln">dot</span><span class="pun">(</span><span class="pln">C</span><span class="pun">,</span><span class="pln">s</span><span class="pun">),</span><span class="pln">dot</span><span class="pun">(</span><span class="pln">D</span><span class="pun">,</span><span class="pln">s</span><span class="pun">));</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">return</span><span class="pln"> fract</span><span class="pun">(</span><span class="pln">tan</span><span class="pun">(</span><span class="pln">tmp</span><span class="pun">)</span><span class="pln"> &nbsp;</span><span class="pun">*</span><span class="pln"> </span><span class="lit">43758</span><span class="pun">.</span><span class="lit">5453</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="kwd">float</span><span class="pln"> noise</span><span class="pun">(</span><span class="pln">vec2 coord</span><span class="pun">,</span><span class="kwd">float</span><span class="pln"> d</span><span class="pun">){</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;vec2 C</span><span class="pun">[</span><span class="lit">4</span><span class="pun">];</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;C</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> floor</span><span class="pun">(</span><span class="pln"> coord </span><span class="pun">*</span><span class="pln"> d</span><span class="pun">)/</span><span class="pln">d </span><span class="pun">;</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;C</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> C</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> vec2</span><span class="pun">(</span><span class="lit">1</span><span class="pun">.</span><span class="lit">0</span><span class="pun">/</span><span class="pln">d </span><span class="pun">,</span><span class="lit">0</span><span class="pun">.</span><span class="lit">0</span><span class="pln"> &nbsp;</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;C</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> C</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> vec2</span><span class="pun">(</span><span class="lit">1</span><span class="pun">.</span><span class="lit">0</span><span class="pun">/</span><span class="pln">d </span><span class="pun">,</span><span class="lit">1</span><span class="pun">.</span><span class="lit">0</span><span class="pun">/</span><span class="pln">d</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;C</span><span class="pun">[</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> C</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> vec2</span><span class="pun">(</span><span class="lit">0</span><span class="pun">.</span><span class="lit">0</span><span class="pln"> &nbsp; </span><span class="pun">,</span><span class="lit">1</span><span class="pun">.</span><span class="lit">0</span><span class="pun">/</span><span class="pln">d</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;vec2 p </span><span class="pun">=</span><span class="pln"> fract</span><span class="pun">(</span><span class="pln">coord </span><span class="pun">*</span><span class="pln"> d</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;vec2 q </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">.</span><span class="lit">0</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> p</span><span class="pun">;</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;vec4 w </span><span class="pun">=</span><span class="pln"> vec4</span><span class="pun">(</span><span class="pln">q</span><span class="pun">.</span><span class="pln">x </span><span class="pun">*</span><span class="pln"> q</span><span class="pun">.</span><span class="pln">y</span><span class="pun">,</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">x </span><span class="pun">*</span><span class="pln"> q</span><span class="pun">.</span><span class="pln">y</span><span class="pun">,</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">x </span><span class="pun">*</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">y</span><span class="pun">,</span><span class="pln"> q</span><span class="pun">.</span><span class="pln">x </span><span class="pun">*</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">y</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">return</span><span class="pln"> dot</span><span class="pun">(</span><span class="pln">vec4</span><span class="pun">(</span><span class="pln">rand</span><span class="pun">(</span><span class="pln">C</span><span class="pun">[</span><span class="lit">0</span><span class="pun">],</span><span class="pln">C</span><span class="pun">[</span><span class="lit">1</span><span class="pun">],</span><span class="pln">C</span><span class="pun">[</span><span class="lit">2</span><span class="pun">],</span><span class="pln">C</span><span class="pun">[</span><span class="lit">3</span><span class="pun">])),</span><span class="pln">w</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="kwd">void</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">){</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;gl_FragColor </span><span class="pun">=</span><span class="pln"> noise</span><span class="pun">(</span><span class="pln">gl_TexCoord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">xy</span><span class="pun">,</span><span class="lit">128</span><span class="pun">.</span><span class="lit">0</span><span class="pln"> </span><span class="pun">);</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span></pre>
<br>This shader is a littlebit optimized for vector based GPUs. "cgc" will compile that code 
<br>to 29 instructions.
<br>
<br><font size="4">3. Better filtered noise</font>
<br>
<br>The previous implementation lacks in filteringquality if the procedural material is 
<br>undersampled by the rasterizer. A solution is, to add only a noise octave only if it 
<br>will be oversampled by the rasterizer. The calculation is exactly the same like for 
<br>calculating a mipmap level. This means that filtered noise has the same anisotropic 
<br>filtering problems like a texture.
<br>
<br>
<br><pre class="prettyprint"><span class="pln">vec4 rand</span><span class="pun">(</span><span class="pln">vec2 A</span><span class="pun">,</span><span class="pln">vec2 B</span><span class="pun">,</span><span class="pln">vec2 C</span><span class="pun">,</span><span class="pln">vec2 D</span><span class="pun">){</span><span class="pln"> 
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;vec2 s</span><span class="pun">=</span><span class="pln">vec2</span><span class="pun">(</span><span class="lit">12</span><span class="pun">.</span><span class="lit">9898</span><span class="pun">,</span><span class="lit">78</span><span class="pun">.</span><span class="lit">233</span><span class="pun">);</span><span class="pln"> 
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;vec4 tmp</span><span class="pun">=</span><span class="pln">vec4</span><span class="pun">(</span><span class="pln">dot</span><span class="pun">(</span><span class="pln">A</span><span class="pun">,</span><span class="pln">s</span><span class="pun">),</span><span class="pln">dot</span><span class="pun">(</span><span class="pln">B</span><span class="pun">,</span><span class="pln">s</span><span class="pun">),</span><span class="pln">dot</span><span class="pun">(</span><span class="pln">C</span><span class="pun">,</span><span class="pln">s</span><span class="pun">),</span><span class="pln">dot</span><span class="pun">(</span><span class="pln">D</span><span class="pun">,</span><span class="pln">s</span><span class="pun">));</span><span class="pln"> 
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">return</span><span class="pln"> fract</span><span class="pun">(</span><span class="pln">sin</span><span class="pun">(</span><span class="pln">tmp</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">43758</span><span class="pun">.</span><span class="lit">5453</span><span class="pun">)*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">.</span><span class="lit">0</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">.</span><span class="lit">0</span><span class="pun">;</span><span class="pln"> 
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln"> 
</span><br><span class="pln"> 
</span><br><span class="kwd">float</span><span class="pln"> noise</span><span class="pun">(</span><span class="pln">vec2 coord</span><span class="pun">,</span><span class="kwd">float</span><span class="pln"> d</span><span class="pun">){</span><span class="pln"> 
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;vec2 C</span><span class="pun">[</span><span class="lit">4</span><span class="pun">];</span><span class="pln"> 
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">float</span><span class="pln"> d1 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">.</span><span class="lit">0</span><span class="pun">/</span><span class="pln">d</span><span class="pun">;</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;C</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]=</span><span class="pln">floor</span><span class="pun">(</span><span class="pln">coord</span><span class="pun">*</span><span class="pln">d</span><span class="pun">)*</span><span class="pln">d1</span><span class="pun">;</span><span class="pln"> 
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;C</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]=</span><span class="pln">C</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]+</span><span class="pln">vec2</span><span class="pun">(</span><span class="pln">d1</span><span class="pun">,</span><span class="lit">0</span><span class="pun">.</span><span class="lit">0</span><span class="pun">);</span><span class="pln"> 
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;C</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]=</span><span class="pln">C</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]+</span><span class="pln">vec2</span><span class="pun">(</span><span class="pln">d1</span><span class="pun">,</span><span class="pln">d1</span><span class="pun">);</span><span class="pln"> 
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;C</span><span class="pun">[</span><span class="lit">3</span><span class="pun">]=</span><span class="pln">C</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]+</span><span class="pln">vec2</span><span class="pun">(</span><span class="lit">0</span><span class="pun">.</span><span class="lit">0</span><span class="pun">,</span><span class="pln">d1</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln"> 
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;vec2 p</span><span class="pun">=</span><span class="pln">fract</span><span class="pun">(</span><span class="pln">coord</span><span class="pun">*</span><span class="pln">d</span><span class="pun">);</span><span class="pln"> 
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;vec2 q</span><span class="pun">=</span><span class="lit">1</span><span class="pun">.</span><span class="lit">0</span><span class="pun">-</span><span class="pln">p</span><span class="pun">;</span><span class="pln"> 
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;vec4 w</span><span class="pun">=</span><span class="pln">vec4</span><span class="pun">(</span><span class="pln">q</span><span class="pun">.</span><span class="pln">x</span><span class="pun">*</span><span class="pln">q</span><span class="pun">.</span><span class="pln">y</span><span class="pun">,</span><span class="pln">p</span><span class="pun">.</span><span class="pln">x</span><span class="pun">*</span><span class="pln">q</span><span class="pun">.</span><span class="pln">y</span><span class="pun">,</span><span class="pln">p</span><span class="pun">.</span><span class="pln">x</span><span class="pun">*</span><span class="pln">p</span><span class="pun">.</span><span class="pln">y</span><span class="pun">,</span><span class="pln">q</span><span class="pun">.</span><span class="pln">x</span><span class="pun">*</span><span class="pln">p</span><span class="pun">.</span><span class="pln">y</span><span class="pun">);</span><span class="pln"> 
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">return</span><span class="pln"> dot</span><span class="pun">(</span><span class="pln">vec4</span><span class="pun">(</span><span class="pln">rand</span><span class="pun">(</span><span class="pln">C</span><span class="pun">[</span><span class="lit">0</span><span class="pun">],</span><span class="pln">C</span><span class="pun">[</span><span class="lit">1</span><span class="pun">],</span><span class="pln">C</span><span class="pun">[</span><span class="lit">2</span><span class="pun">],</span><span class="pln">C</span><span class="pun">[</span><span class="lit">3</span><span class="pun">])),</span><span class="pln">w</span><span class="pun">);</span><span class="pln"> 
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln"> 
</span><br><span class="pln">
</span><br><span class="kwd">void</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">){</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">float</span><span class="pln"> level</span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="pln">log2
</span><br><span class="pun">(</span><span class="pln">min</span><span class="pun">(</span><span class="pln">length</span><span class="pun">(</span><span class="pln">dFdx</span><span class="pun">(</span><span class="pln">gl_TexCoord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">st</span><span class="pun">)),</span><span class="pln">length</span><span class="pun">(</span><span class="pln">dFdy</span><span class="pun">(</span><span class="pln">gl_TexCoord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">st</span><span class="pun">))));</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;level </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">level</span><span class="pun">,</span><span class="lit">13</span><span class="pun">.</span><span class="lit">0</span><span class="pun">);</span><span class="pln"> </span><span class="com">//limit the level to avoid slowness</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">float</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">.</span><span class="lit">5</span><span class="pun">;</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln"> level</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln"> </span><span class="com">//3 is the lowest noise level</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n </span><span class="pun">+=</span><span class="pln"> &nbsp;</span><span class="lit">0</span><span class="pun">.</span><span class="lit">12</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> noise</span><span class="pun">(</span><span class="pln">gl_TexCoord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">xy</span><span class="pun">,</span><span class="pln"> exp2</span><span class="pun">(</span><span class="pln">i</span><span class="pun">));</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;gl_FragColor </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span></pre>
<br>
<br><img src="Noise_tiedostot/lumina106.jpg" alt="">
<br>A bilinear filtered noise with mipmap like filtering. Notice the washed out structure on 
<br>the tilted surface. Only an anisotropic filtering algorithm would help.
<br>
<br>Now it's possible to add a trilinear like filtering by modifying the main function:
<br><pre class="prettyprint"><br><span class="kwd">void</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">){</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">float</span><span class="pln"> level</span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">.</span><span class="lit">0</span><span class="pln"> </span><span class="pun">-</span><span class="pln">log2 
</span><br><span class="pun">(</span><span class="pln">min</span><span class="pun">(</span><span class="pln">length</span><span class="pun">(</span><span class="pln">dFdx</span><span class="pun">(</span><span class="pln">gl_TexCoord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">st</span><span class="pun">)),</span><span class="pln">length</span><span class="pun">(</span><span class="pln">dFdy</span><span class="pun">(</span><span class="pln">gl_TexCoord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">st</span><span class="pun">))));</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">//-1.0 is a bias shift to avoid flickering</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;level </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">level</span><span class="pun">,</span><span class="lit">16</span><span class="pun">.</span><span class="lit">0</span><span class="pun">);</span><span class="pln"> </span><span class="com">//limit the level. Equalient to a 65536x65536 texture</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">float</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">.</span><span class="lit">5</span><span class="pun">;</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln"> level</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n </span><span class="pun">+=</span><span class="pln"> &nbsp;</span><span class="lit">0</span><span class="pun">.</span><span class="lit">12</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> noise</span><span class="pun">(</span><span class="pln">gl_TexCoord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">xy</span><span class="pun">,</span><span class="pln"> exp2</span><span class="pun">(</span><span class="pln">i</span><span class="pun">));</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;n </span><span class="pun">+=</span><span class="pln"> &nbsp;</span><span class="lit">0</span><span class="pun">.</span><span class="lit">12</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> noise</span><span class="pun">(</span><span class="pln">gl_TexCoord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">xy</span><span class="pun">,</span><span class="pln"> exp2</span><span class="pun">(</span><span class="pln">floor</span><span class="pun">(</span><span class="pln">level</span><span class="pun">)+</span><span class="lit">1</span><span class="pun">.</span><span class="lit">0</span><span class="pun">))</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> fract</span><span class="pun">(</span><span class="pln">level</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// add the last level multiplied with the fraction of the </span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// level calculation for a smooth filtering &nbsp; &nbsp; </span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;gl_FragColor </span><span class="pun">=</span><span class="pln"> &nbsp;max</span><span class="pun">(</span><span class="lit">0</span><span class="pun">.</span><span class="lit">0</span><span class="pun">,</span><span class="pln">sin </span><span class="pun">(</span><span class="pln">n</span><span class="pun">*</span><span class="pln"> </span><span class="lit">12</span><span class="pun">.</span><span class="lit">0</span><span class="pun">))*</span><span class="pln"> vec4</span><span class="pun">(</span><span class="lit">0</span><span class="pun">.</span><span class="lit">3</span><span class="pun">,</span><span class="lit">0</span><span class="pun">.</span><span class="lit">8</span><span class="pun">,</span><span class="lit">0</span><span class="pun">.</span><span class="lit">4</span><span class="pun">,</span><span class="lit">0</span><span class="pun">.</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> vec4
</span><br><span class="pun">(</span><span class="lit">0</span><span class="pun">.</span><span class="lit">3</span><span class="pun">,</span><span class="lit">0</span><span class="pun">.</span><span class="lit">3</span><span class="pun">,</span><span class="lit">0</span><span class="pun">.</span><span class="lit">5</span><span class="pun">,</span><span class="lit">0</span><span class="pun">.</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> n</span><span class="pun">;</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln">
</span><br></pre>
<br>
<br><img src="Noise_tiedostot/lumina107.jpg" alt="">
<br>
<br>
<br>
<br><font size="4">4. Texture based noise</font>
<br>The previous noise version aren't very performant. Using textures has some advantages 
<br>like working anisotropic filtering or four independent values. The input texture should 
<br>be a small texture (smaller textures will be better cached). This small texture can be 
<br>generated easily with a small program or gimp:
<br>
<br><img src="Noise_tiedostot/rand.png" alt="">
<br>
<br>The shader uses parts from the previous version:
<br><pre class="prettyprint"><br><span class="pln">uniform sampler2D random</span><span class="pun">;</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="pln">
</span><br><span class="kwd">void</span><span class="pln"> main</span><span class="pun">(</span><span class="kwd">void</span><span class="pun">){</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">float</span><span class="pln"> level</span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">0</span><span class="pun">.</span><span class="lit">5</span><span class="pln"> </span><span class="pun">-</span><span class="pln">log2 
</span><br><span class="pun">(</span><span class="pln">min</span><span class="pun">(</span><span class="pln">length</span><span class="pun">(</span><span class="pln">dFdx</span><span class="pun">(</span><span class="pln">gl_TexCoord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">st</span><span class="pun">)),</span><span class="pln">length</span><span class="pun">(</span><span class="pln">dFdy</span><span class="pun">(</span><span class="pln">gl_TexCoord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">st</span><span class="pun">))));</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">//-0.5 is a bias shift to avoid flickering</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;level </span><span class="pun">=</span><span class="pln"> min</span><span class="pun">(</span><span class="pln">level</span><span class="pun">,</span><span class="lit">20</span><span class="pun">.</span><span class="lit">0</span><span class="pun">);</span><span class="pln"> </span><span class="com">//limit the level. Equalient to a 1Mx1M texture</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;vec4 n </span><span class="pun">=</span><span class="pln"> vec4</span><span class="pun">(</span><span class="lit">0</span><span class="pun">.</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">.</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">.</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">.</span><span class="lit">0</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;vec2 coords </span><span class="pun">=</span><span class="pln"> &nbsp;gl_TexCoord</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">xy </span><span class="pun">/</span><span class="pln"> </span><span class="lit">8</span><span class="pun">;</span><span class="pln"> </span><span class="com">// note1</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln"> level</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++){</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n </span><span class="pun">+=</span><span class="pln"> &nbsp;</span><span class="lit">0</span><span class="pun">.</span><span class="lit">32</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">texture2D</span><span class="pun">(</span><span class="pln">random</span><span class="pun">,</span><span class="pln"> coords</span><span class="pun">)-</span><span class="lit">0</span><span class="pun">.</span><span class="lit">5</span><span class="pun">)</span><span class="pln"> </span><span class="pun">;</span><span class="com">//-0.05;</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;coords </span><span class="pun">*=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">.</span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span><span class="pln">
</span><br><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;n </span><span class="pun">+=</span><span class="pln"> &nbsp;</span><span class="lit">0</span><span class="pun">.</span><span class="lit">32</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">texture2D</span><span class="pun">(</span><span class="pln">random</span><span class="pun">,</span><span class="pln"> coords</span><span class="pun">)-</span><span class="pln"> </span><span class="lit">0</span><span class="pun">.</span><span class="lit">5</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> fract</span><span class="pun">(</span><span class="pln">level</span><span class="pun">);</span><span class="pln">
</span><br><span class="pln"> &nbsp;
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;gl_FragColor </span><span class="pun">=</span><span class="pln"> &nbsp;n</span><span class="pun">;</span><span class="pln">
</span><br><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">}</span></pre>
<br>note1: The mipmap levels 3,4 and 5 don't wrap correctly, because only a part of the 
<br>texture is used for this low resolution maps. The best solution is to start the for loop 
<br>with log2(texture_size) and remove the divisor. The low frequency part can be easily 
<br>replaced by a 64x64 texture with mipmaps.
<br>
<br><img src="Noise_tiedostot/lumina108.jpg" alt="">
<br>For the GF8 it's a good idea to use a anisotropic filter. The 2x AF would be priceless, 
<br>because the TMUs are able to filter 2 bilinear samples at the same time.
<br>
<br>
<br>
<br>                <!-- content end //-->
                </td>

        </tr>
        <tr>
                <td style="background-image: url(../images/index_12.gif); background-attachment: scroll; background-repeat: repeat;"></td>
        </tr>
	 <tr>
                <td>
                        <img src="Noise_tiedostot/spacer.gif" alt="" width="100" height="1"></td>
                <td>
                        <img src="Noise_tiedostot/spacer.gif" alt="" width="11" height="1"></td>
                <td>
                        <img src="Noise_tiedostot/spacer.gif" alt="" width="229" height="1"></td>
                <td>
                        <img src="Noise_tiedostot/spacer.gif" alt="" width="135" height="1"></td>
                <td>
                        <img src="Noise_tiedostot/spacer.gif" alt="" width="100" height="1"></td>
                <td>
                        <img src="Noise_tiedostot/spacer.gif" alt="" width="145" height="1"></td>
                <td>
                        <img src="Noise_tiedostot/spacer.gif" alt="" width="280" height="1"><!-- WIDTH=1000 ROWSPAN=7 //--></td>

        </tr>
</tbody></table>
<a href="" onclick='window.location.href="../index.php?url=Tutorials/Noise&amp;pwd="+window.prompt("Passwort eingeben","");return false;' class="links">EDIT</a> 
</body></html>